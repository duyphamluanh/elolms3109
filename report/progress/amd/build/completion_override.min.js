define(["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","report_progress/jquery.dataTables","report_progress/dataTables.buttons","report_progress/dataTables.fixedHeader","report_progress/dataTables.select","core/custom_interaction_events","core/templates"],function(e,t,n,o,r,a,i,c,s,l,p,d){var m,u,g=function(e,t){return e>0?"i/completion-"+t+"-y-override":"i/completion-"+t+"-n-override"},f=function(e){d.render("core/loading",{}).then(function(n){return u.append(n),t.call([{methodname:"core_completion_override_activity_completion_status",args:e}])[0]}).then(function(t){var o=t.state>0?1:0,r=o?"completion-y-override":"completion-n-override";n.get_string(r,"completion",m).then(function(e){var t={state:e,date:"",user:u.attr("data-userfullname"),activity:u.attr("data-activityname")};return n.get_string("progress-title","completion",t)}).then(function(e){var t=u.attr("data-completiontracking");return d.renderPix(g(o,t),"core",e)}).then(function(t){var n=o>0?0:1;u.find(".loading-icon").remove(),u.data("changecompl",e.userid+"-"+e.cmid+"-"+n),u.attr("data-changecompl",e.userid+"-"+e.cmid+"-"+n),u.children("img").replaceWith(t)})["catch"](a.exception)})["catch"](a.exception)},v=function(t,i){i.originalEvent.preventDefault(),i.originalEvent.stopPropagation(),t.preventDefault(),t.stopPropagation(),u=e(t.currentTarget);var c=u.data("changecompl").split("-"),s={userid:c[0],cmid:c[1],newstate:c[2]},l=1==s.newstate?"completion-y":"completion-n";n.get_strings([{key:l,component:"completion"}]).then(function(e){return n.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:e[0]}])}).then(function(e){return o.create({type:o.types.SAVE_CANCEL,title:e[0],body:e[1]})}).then(function(e){e.getRoot().on(r.save,function(){f(s)}),e.getRoot().on(r.hidden,function(){u.focus(),e.destroy()}),e.show()})["catch"](a.exception)},h=function(t){m=t,e("#completion-progress a.changecompl").each(function(e,t){p.define(t,[p.events.activate])}),e("#completion-progress").on(p.events.activate,"a.changecompl",function(e,t){v(e,t)});e("#completion-progress").DataTable({language:{emptyTable:"No data available in table",searchPanes:{emptyPanes:"There are no panes to display. :/"}},fixedHeader:{headerOffset:25},columnDefs:[{defaultContent:"-",targets:"_all"}],ordering:!0,columnDefs:[{orderable:!1,targets:"no-sort"}]})};return{init:h}});